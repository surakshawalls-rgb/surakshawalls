<div class="app-safe-container" *ngIf="authService.isLoggedIn">

  <div class="top-header">
    <div class="header-left">
      ğŸ— Suraksha Walls
    </div>
    <div class="header-right">
      <span class="user-info">ğŸ‘¤ {{ currentUser?.full_name || currentUser?.email }}</span>
      <button class="btn-logout" (click)="logout()">ğŸšª Logout</button>
    </div>
  </div>

  <div class="menu-bar">
    <button routerLink="/reports-dashboard" *ngIf="hasManufacturingAccess()">ğŸ“Š Dashboard</button>
    
    <!-- ğŸ­ PRODUCTION MODULE -->
    <details class="menu-group" *ngIf="hasManufacturingAccess()">
      <summary>ğŸ­ Production</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/production-entry">â• Production Entry</button>
        <button (click)="closeMenu()" routerLink="/worker-management">ğŸ‘· Worker Management</button>
        <button (click)="closeMenu()" routerLink="/inventory">ğŸ“¦ Inventory</button>
      </div>
    </details>

    <!-- ğŸ’° SALES MODULE -->
    <details class="menu-group" *ngIf="hasManufacturingAccess()">
      <summary>ğŸ’° Sales</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/sales-entry">ğŸ’³ Sales Entry</button>
        <button (click)="closeMenu()" routerLink="/client-ledger">ğŸ‘¥ Client Ledger</button>
      </div>
    </details>

    <!-- ğŸ“¦ MATERIALS MODULE -->
    <details class="menu-group" *ngIf="hasManufacturingAccess()">
      <summary>ğŸ“¦ Materials</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/material-purchase">ğŸ›’ Material Purchase</button>
        <button (click)="closeMenu()" routerLink="/yard-loss">âš ï¸ Yard Loss</button>
        <button (click)="closeMenu()" routerLink="/stock-audit">âœ… Stock Audit</button>
      </div>
    </details>

    <!-- ğŸ“ˆ REPORTS MODULE -->
    <details class="menu-group" *ngIf="hasManufacturingAccess()">
      <summary>ğŸ“ˆ Reports</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/reports-dashboard">ğŸ“Š Reports Dashboard</button>
      </div>
    </details>

    <!-- ğŸ¤ PARTNER MODULE -->
    <details class="menu-group" *ngIf="authService.isAdmin()">
      <summary>ğŸ¤ Partner</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/partner-dashboard">ğŸ“Š Dashboard</button>
        <button (click)="closeMenu()" routerLink="/partner">âš™ï¸ Settings</button>
      </div>
    </details>

    <!-- ğŸ“š LIBRARY MODULE (Separate Business) -->
    <!-- Full Library Menu for Admin, Editor, Library Manager -->
    <details class="menu-group" *ngIf="hasLibraryAccess() && hasFullLibraryAccess()">
      <summary>ğŸ“š Library</summary>
      <div class="submenu">
        <button (click)="closeMenu()" routerLink="/library-grid">ğŸ¯ Seat Grid</button>
        <button (click)="closeMenu()" routerLink="/library-dashboard">ğŸ“Š Dashboard</button>
        <button (click)="closeMenu()" routerLink="/library-students">ğŸ‘¨â€ğŸ“ Students</button>
        <button (click)="closeMenu()" routerLink="/library-expenses">ğŸ’¸ Expenses</button>
      </div>
    </details>

    <!-- Direct Link to Seat Grid for Library Viewers -->
    <button *ngIf="hasLibraryAccess() && !hasFullLibraryAccess()" 
            (click)="closeMenu()" 
            routerLink="/library-grid"
            class="primary-btn">
      ğŸ“š Library - Seat Grid
    </button>
  </div>

  <div class="content-area">
    <router-outlet></router-outlet>
  </div>

</div>

<!-- Show login page if not authenticated -->
<router-outlet *ngIf="!authService.isLoggedIn"></router-outlet>
