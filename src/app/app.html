<!-- PRIVATE VIEW: Logged In Users -->
<div class="app-container" *ngIf="authService.isLoggedIn">
  <mat-toolbar color="primary" class="app-toolbar">
    <span class="app-title">
      <mat-icon class="title-icon">shield</mat-icon>
      SURAKSHA GROUP
    </span>
    
    <!-- Main Navigation Menu -->
    <nav class="main-nav" *ngIf="!(isHandset$ | async)">
      <!-- Manufacturing Section -->
      <ng-container *ngIf="hasManufacturingAccess()">
        <button mat-button [matMenuTriggerFor]="productionMenu" class="nav-button">
          <mat-icon>factory</mat-icon>
          <span>Production</span>
          <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
        </button>
        <mat-menu #productionMenu="matMenu" class="nav-dropdown">
          <button mat-menu-item routerLink="/dashboard" routerLinkActive="active">
            <mat-icon>inventory</mat-icon>
            <span>Stock Dashboard</span>
          </button>
          <button mat-menu-item routerLink="/production-entry" routerLinkActive="active">
            <mat-icon>add_circle</mat-icon>
            <span>Production Entry</span>
          </button>
          <button mat-menu-item routerLink="/worker-management" routerLinkActive="active">
            <mat-icon>engineering</mat-icon>
            <span>Worker Management</span>
          </button>
          <button mat-menu-item routerLink="/inventory" routerLinkActive="active">
            <mat-icon>inventory_2</mat-icon>
            <span>Inventory</span>
          </button>
        </mat-menu>

        <button mat-button [matMenuTriggerFor]="salesMenu" class="nav-button">
          <mat-icon>point_of_sale</mat-icon>
          <span>Sales</span>
          <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
        </button>
        <mat-menu #salesMenu="matMenu" class="nav-dropdown">
          <button mat-menu-item routerLink="/sales-entry" routerLinkActive="active">
            <mat-icon>receipt</mat-icon>
            <span>Sales Entry</span>
          </button>
          <button mat-menu-item routerLink="/client-ledger" routerLinkActive="active">
            <mat-icon>people</mat-icon>
            <span>Client Ledger</span>
          </button>
        </mat-menu>

        <button mat-button [matMenuTriggerFor]="materialsMenu" class="nav-button">
          <mat-icon>inventory</mat-icon>
          <span>Materials</span>
          <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
        </button>
        <mat-menu #materialsMenu="matMenu" class="nav-dropdown">
          <button mat-menu-item routerLink="/material-purchase" routerLinkActive="active">
            <mat-icon>shopping_cart</mat-icon>
            <span>Material Purchase</span>
          </button>
          <button mat-menu-item routerLink="/yard-loss" routerLinkActive="active">
            <mat-icon>warning</mat-icon>
            <span>Yard Loss</span>
          </button>
          <button mat-menu-item routerLink="/stock-audit" routerLinkActive="active">
            <mat-icon>fact_check</mat-icon>
            <span>Stock Audit</span>
          </button>
        </mat-menu>

        <button mat-button routerLink="/reports-dashboard" class="nav-button">
          <mat-icon>assessment</mat-icon>
          <span>Reports</span>
        </button>
      </ng-container>

      <!-- Partner Section -->
      <ng-container *ngIf="authService.isAdmin()">
        <button mat-button [matMenuTriggerFor]="partnerMenu" class="nav-button">
          <mat-icon>handshake</mat-icon>
          <span>Partner</span>
          <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
        </button>
        <mat-menu #partnerMenu="matMenu" class="nav-dropdown">
          <button mat-menu-item routerLink="/partner-dashboard" routerLinkActive="active">
            <mat-icon>dashboard</mat-icon>
            <span>Partner Dashboard</span>
          </button>
          <button mat-menu-item routerLink="/partner" routerLinkActive="active">
            <mat-icon>settings</mat-icon>
            <span>Partner Settings</span>
          </button>
        </mat-menu>
      </ng-container>

      <!-- Library Section -->
      <ng-container *ngIf="hasLibraryAccess()">
        <button mat-button [matMenuTriggerFor]="libraryMenu" class="nav-button">
          <mat-icon>local_library</mat-icon>
          <span>Library</span>
          <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
        </button>
        <mat-menu #libraryMenu="matMenu" class="nav-dropdown">
          <button mat-menu-item routerLink="/library-grid" routerLinkActive="active">
            <mat-icon>grid_on</mat-icon>
            <span>Seat Grid</span>
          </button>
          <ng-container *ngIf="hasFullLibraryAccess()">
            <button mat-menu-item routerLink="/library-dashboard" routerLinkActive="active">
              <mat-icon>dashboard</mat-icon>
              <span>Library Dashboard</span>
            </button>
            <button mat-menu-item routerLink="/library-students" routerLinkActive="active">
              <mat-icon>school</mat-icon>
              <span>Students</span>
            </button>
            <button mat-menu-item routerLink="/library-expenses" routerLinkActive="active">
              <mat-icon>payments</mat-icon>
              <span>Expenses</span>
            </button>
          </ng-container>
        </mat-menu>
      </ng-container>
    </nav>

    <!-- Mobile Menu Button -->
    <button mat-icon-button 
            *ngIf="isHandset$ | async" 
            [matMenuTriggerFor]="mobileMenu"
            class="mobile-menu-btn"
            aria-label="Open menu">
      <mat-icon>menu</mat-icon>
    </button>

    <span class="toolbar-spacer"></span>
    
    <span class="user-badge">
      <mat-icon>account_circle</mat-icon>
      {{ currentUser?.full_name || currentUser?.email }}
    </span>
    
    <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="User menu">
      <mat-icon>more_vert</mat-icon>
    </button>
    
    <mat-menu #userMenu="matMenu" xPosition="before">
      <button mat-menu-item disabled>
        <mat-icon>person</mat-icon>
        <span>{{ currentUser?.full_name || currentUser?.email }}</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>exit_to_app</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>

    <!-- Mobile Full Menu -->
    <mat-menu #mobileMenu="matMenu" class="mobile-nav-menu">
      <ng-container *ngIf="hasManufacturingAccess()">
        <button mat-menu-item routerLink="/dashboard">
          <mat-icon>inventory</mat-icon>
          <span>Stock Dashboard</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item disabled class="menu-section-header">
          <mat-icon>factory</mat-icon>
          <span>Production</span>
        </button>
        <button mat-menu-item routerLink="/production-entry">
          <mat-icon>add_circle</mat-icon>
          <span>Production Entry</span>
        </button>
        <button mat-menu-item routerLink="/worker-management">
          <mat-icon>engineering</mat-icon>
          <span>Worker Management</span>
        </button>
        <button mat-menu-item routerLink="/inventory">
          <mat-icon>inventory_2</mat-icon>
          <span>Inventory</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item disabled class="menu-section-header">
          <mat-icon>point_of_sale</mat-icon>
          <span>Sales</span>
        </button>
        <button mat-menu-item routerLink="/sales-entry">
          <mat-icon>receipt</mat-icon>
          <span>Sales Entry</span>
        </button>
        <button mat-menu-item routerLink="/client-ledger">
          <mat-icon>people</mat-icon>
          <span>Client Ledger</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item disabled class="menu-section-header">
          <mat-icon>inventory</mat-icon>
          <span>Materials</span>
        </button>
        <button mat-menu-item routerLink="/material-purchase">
          <mat-icon>shopping_cart</mat-icon>
          <span>Material Purchase</span>
        </button>
        <button mat-menu-item routerLink="/yard-loss">
          <mat-icon>warning</mat-icon>
          <span>Yard Loss</span>
        </button>
        <button mat-menu-item routerLink="/stock-audit">
          <mat-icon>fact_check</mat-icon>
          <span>Stock Audit</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/reports-dashboard">
          <mat-icon>assessment</mat-icon>
          <span>Reports Dashboard</span>
        </button>
      </ng-container>
      <ng-container *ngIf="authService.isAdmin()">
        <mat-divider></mat-divider>
        <button mat-menu-item disabled class="menu-section-header">
          <mat-icon>handshake</mat-icon>
          <span>Partner</span>
        </button>
        <button mat-menu-item routerLink="/partner-dashboard">
          <mat-icon>dashboard</mat-icon>
          <span>Partner Dashboard</span>
        </button>
        <button mat-menu-item routerLink="/partner">
          <mat-icon>settings</mat-icon>
          <span>Partner Settings</span>
        </button>
      </ng-container>
      <ng-container *ngIf="hasLibraryAccess()">
        <mat-divider></mat-divider>
        <button mat-menu-item disabled class="menu-section-header">
          <mat-icon>local_library</mat-icon>
          <span>Library</span>
        </button>
        <button mat-menu-item routerLink="/library-grid">
          <mat-icon>grid_on</mat-icon>
          <span>Seat Grid</span>
        </button>
        <ng-container *ngIf="hasFullLibraryAccess()">
          <button mat-menu-item routerLink="/library-dashboard">
            <mat-icon>dashboard</mat-icon>
            <span>Library Dashboard</span>
          </button>
          <button mat-menu-item routerLink="/library-students">
            <mat-icon>school</mat-icon>
            <span>Students</span>
          </button>
          <button mat-menu-item routerLink="/library-expenses">
            <mat-icon>payments</mat-icon>
            <span>Expenses</span>
          </button>
        </ng-container>
      </ng-container>
    </mat-menu>
  </mat-toolbar>

  <div class="main-content">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>

<!-- PUBLIC VIEW: NOT LOGGED IN -->
<div class="public-container" *ngIf="!authService.isLoggedIn">
  <router-outlet></router-outlet>
</div>


