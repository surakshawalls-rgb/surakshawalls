<div class="app-safe-container" *ngIf="authService.isLoggedIn">

  <div class="top-header">
    <div class="header-spacer"></div>
    <div class="header-center">
      ğŸ›¡ï¸ SURAKSHA GROUP
    </div>
    <div class="header-right">
      <span class="user-info">ğŸ‘¤ {{ currentUser?.full_name || currentUser?.email }}</span>
      <button class="btn-logout" (click)="logout()">ğŸšª Logout</button>
    </div>
  </div>

  <div class="menu-bar">
    <button routerLink="/reports-dashboard" *ngIf="hasManufacturingAccess()">ğŸ“Š Dashboard</button>
    
    <!-- ğŸ­ PRODUCTION MODULE -->
    <button *ngIf="hasManufacturingAccess()" [matMenuTriggerFor]="productionMenu">ğŸ­ Production</button>
    <mat-menu #productionMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/production-entry">â• Production Entry</button>
      <button mat-menu-item routerLink="/worker-management">ğŸ‘· Worker Management</button>
      <button mat-menu-item routerLink="/inventory">ğŸ“¦ Inventory</button>
    </mat-menu>

    <!-- ğŸ’° SALES MODULE -->
    <button *ngIf="hasManufacturingAccess()" [matMenuTriggerFor]="salesMenu">ğŸ’° Sales</button>
    <mat-menu #salesMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/sales-entry">ğŸ’³ Sales Entry</button>
      <button mat-menu-item routerLink="/client-ledger">ğŸ‘¥ Client Ledger</button>
    </mat-menu>

    <!-- ğŸ“¦ MATERIALS MODULE -->
    <button *ngIf="hasManufacturingAccess()" [matMenuTriggerFor]="materialsMenu">ğŸ“¦ Materials</button>
    <mat-menu #materialsMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/material-purchase">ğŸ›’ Material Purchase</button>
      <button mat-menu-item routerLink="/yard-loss">âš ï¸ Yard Loss</button>
      <button mat-menu-item routerLink="/stock-audit">âœ… Stock Audit</button>
    </mat-menu>

    <!-- ğŸ“ˆ REPORTS MODULE -->
    <button *ngIf="hasManufacturingAccess()" [matMenuTriggerFor]="reportsMenu">ğŸ“ˆ Reports</button>
    <mat-menu #reportsMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/reports-dashboard">ğŸ“Š Reports Dashboard</button>
    </mat-menu>

    <!-- ğŸ¤ PARTNER MODULE -->
    <button *ngIf="authService.isAdmin()" [matMenuTriggerFor]="partnerMenu">ğŸ¤ Partner</button>
    <mat-menu #partnerMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/partner-dashboard">ğŸ“Š Dashboard</button>
      <button mat-menu-item routerLink="/partner">âš™ï¸ Settings</button>
    </mat-menu>

    <!-- ğŸ“š LIBRARY MODULE (Separate Business) -->
    <!-- Full Library Menu for Admin, Editor, Library Manager -->
    <button *ngIf="hasLibraryAccess() && hasFullLibraryAccess()" [matMenuTriggerFor]="libraryMenu">ğŸ“š Library</button>
    <mat-menu #libraryMenu="matMenu" yPosition="below">
      <button mat-menu-item routerLink="/library-grid">ğŸ¯ Seat Grid</button>
      <button mat-menu-item routerLink="/library-dashboard">ğŸ“Š Dashboard</button>
      <button mat-menu-item routerLink="/library-students">ğŸ‘¨â€ğŸ“ Students</button>
      <button mat-menu-item routerLink="/library-expenses">ğŸ’¸ Expenses</button>
    </mat-menu>

    <!-- Direct Link to Seat Grid for Library Viewers -->
    <button *ngIf="hasLibraryAccess() && !hasFullLibraryAccess()" 
            routerLink="/library-grid"
            class="primary-btn">
      ğŸ“š Library - Seat Grid
    </button>
  </div>

  <div class="content-area">
    <router-outlet></router-outlet>
  </div>

</div>

<!-- Show login page if not authenticated -->
<router-outlet *ngIf="!authService.isLoggedIn"></router-outlet>
