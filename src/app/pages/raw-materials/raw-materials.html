<div class="raw-materials-container">
  <div class="top-bar">
    <div>
      <h1>üè≠ Raw Materials</h1>
      <p>Manage inventory and purchases</p>
    </div>
    <button (click)="refreshData()" [disabled]="loading" class="btn-refresh">
      {{ loading ? '‚è≥ Loading...' : 'üîÑ Refresh' }}
    </button>
  </div>

  <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <!-- Alerts -->
  <div *ngIf="getLowStockMaterials().length > 0" class="alert-section">
    <h3>‚ö†Ô∏è Low Stock Alert</h3>
    <ul>
      <li *ngFor="let mat of getLowStockMaterials()">
        {{ mat.material_name }}: Only {{ mat.current_stock }} {{ mat.unit }} remaining (Alert: {{ mat.low_stock_alert }} {{ mat.unit }})
      </li>
    </ul>
  </div>

  <!-- Purchase Form -->
  <div class="form-section">
    <h2>Purchase Materials</h2>
    <div class="input-group">
      <label>Material:</label>
      <select [(ngModel)]="selectedMaterial" class="input-field">
        <option *ngFor="let mat of materials" [value]="mat.material_name">{{ mat.material_name }}</option>
      </select>
    </div>
    <div class="input-group">
      <label>Quantity:</label>
      <input type="number" [(ngModel)]="purchaseQuantity" placeholder="0" class="input-field">
    </div>
    <div class="input-group">
      <label>Unit Cost (‚Çπ):</label>
      <input type="number" [(ngModel)]="purchaseUnitCost" placeholder="0" class="input-field">
    </div>
    <div class="input-group">
      <label>Vendor Name:</label>
      <input type="text" [(ngModel)]="vendorName" placeholder="Enter vendor name" class="input-field">
    </div>
    <div class="input-group">
      <label>Date:</label>
      <input type="date" [(ngModel)]="purchaseDate" class="input-field">
    </div>
    <button (click)="recordPurchase()" [disabled]="loading" class="btn-submit">
      {{ loading ? 'Recording...' : 'Record Purchase' }}
    </button>
  </div>

  <!-- Materials Table -->
  <div class="table-section">
    <h2>Current Stock</h2>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Material</th>
            <th>Current Stock</th>
            <th>Unit Cost</th>
            <th>Stock Value</th>
            <th>Alert Level</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let mat of materials" [class.low-stock]="mat.current_stock <= mat.low_stock_alert">
            <td>{{ mat.material_name }}</td>
            <td class="amount">{{ mat.current_stock }} {{ mat.unit }}</td>
            <td class="amount">‚Çπ{{ mat.unit_cost | number:'1.0-2' }}</td>
            <td class="amount">‚Çπ{{ (mat.current_stock * mat.unit_cost) | number:'1.0-2' }}</td>
            <td class="amount">{{ mat.low_stock_alert }} {{ mat.unit }}</td>
            <td>
              <span *ngIf="mat.current_stock > mat.low_stock_alert" class="status-good">‚úÖ OK</span>
              <span *ngIf="mat.current_stock <= mat.low_stock_alert" class="status-alert">‚ö†Ô∏è LOW</span>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="3"><strong>TOTAL STOCK VALUE:</strong></td>
            <td colspan="3"><strong>‚Çπ{{ getTotalStockValue() | number:'1.0-2' }}</strong></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
