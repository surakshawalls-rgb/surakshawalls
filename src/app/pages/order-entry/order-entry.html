<div class="order-entry-container">

  <!-- Top Bar -->
  <div class="top-bar">
    <h2>{{ language === 'EN' ? 'üí≥ Order Entry' : 'üí≥ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä' }}</h2>
    <div class="top-buttons">
      <button class="lang-btn" (click)="toggleLang()">üåê {{language}}</button>
      <button class="history-btn" (click)="toggleHistory()">üìã {{ language === 'EN' ? 'History' : '‡§á‡§§‡§ø‡§π‡§æ‡§∏' }}</button>
    </div>
  </div>

  <!-- Date Input -->
  <div class="date-section">
    <label>{{ language === 'EN' ? 'Date' : '‡§§‡§æ‡§∞‡•Ä‡§ñ' }}:</label>
    <input type="date" [(ngModel)]="order.date">
    <span class="date-display">{{ formatDateToDDMMYYYY(order.date) }}</span>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button [class.active]="activeTab === 'client'" (click)="activeTab = 'client'" class="tab-btn">üë§ Client</button>
    <button [class.active]="activeTab === 'production'" (click)="activeTab = 'production'" class="tab-btn">üè≠ Production</button>
    <button [class.active]="activeTab === 'labour'" (click)="activeTab = 'labour'" class="tab-btn">üë∑ Labour</button>
    <button [class.active]="activeTab === 'charges'" (click)="activeTab = 'charges'" class="tab-btn">‚ûï Charges</button>
    <button [class.active]="activeTab === 'payment'" (click)="activeTab = 'payment'" class="tab-btn">üí∞ Payment</button>
  </div>

  <!-- CLIENT TAB -->
  <div *ngIf="activeTab === 'client'" class="card">
    <h3>CLIENT INFORMATION</h3>
    <div class="form-group">
      <label>Client Name *</label>
      <input type="text" [(ngModel)]="order.client_name" placeholder="Enter client name" class="form-input">
    </div>
    <div class="form-group">
      <label>Phone Number</label>
      <input type="tel" [(ngModel)]="order.client_phone" placeholder="Phone" class="form-input">
    </div>
    <div class="form-group">
      <label>Location / Address</label>
      <input type="text" [(ngModel)]="order.client_location" placeholder="Location" class="form-input">
    </div>
    <div class="form-group checkbox">
      <input type="checkbox" [(ngModel)]="order.is_registered" id="register-checkbox">
      <label for="register-checkbox">Save to Contacts for future use</label>
    </div>
    <button class="next-btn" (click)="activeTab = 'production'">Next ‚Üí</button>
  </div>

  <!-- PRODUCTION TAB -->
  <div *ngIf="activeTab === 'production'" class="card">
    <h3>PRODUCTION ITEMS (Optional)</h3>
    <div class="production-grid">
      <div *ngFor="let item of productionItems" class="production-item">
        <label>{{ item.labelEN }}</label>
        <div class="quantity-control">
          <button (click)="decreaseProduction(item.key)" class="btn-minus">‚àí</button>
          <input type="number" [(ngModel)]="order[item.key]" (change)="updateTotals()" class="quantity-input">
          <button (click)="increaseProduction(item.key)" class="btn-plus">+</button>
        </div>
        <span class="quantity-display">{{ order[item.key] }} units</span>
      </div>
    </div>
    <div class="price-section">
      <label>Price per Unit (‚Çπ)</label>
      <input type="number" [(ngModel)]="order.production_unit_price" (change)="updateTotals()" placeholder="Enter price" class="form-input">
    </div>
    <div class="info-box">
      <p>Total Items: <strong>{{ getTotalProduction() }}</strong></p>
      <p>Production Total: <strong>‚Çπ{{ order.production_total | number: '1.0-0' }}</strong></p>
    </div>
    <div class="tab-buttons">
      <button class="prev-btn" (click)="activeTab = 'client'">‚Üê Back</button>
      <button class="next-btn" (click)="activeTab = 'labour'">Next ‚Üí</button>
    </div>
  </div>

  <!-- LABOUR TAB -->
  <div *ngIf="activeTab === 'labour'" class="card">
    <h3>LABOUR ASSIGNMENT (Optional)</h3>
    <div class="add-labour-form">
      <h4>Add Worker</h4>
      <div class="form-group">
        <label>Worker Name</label>
        <input type="text" [(ngModel)]="newWorker" placeholder="Name" class="form-input">
      </div>
      <div class="form-group">
        <label>Worker Type</label>
        <select [(ngModel)]="workerType" class="form-select">
          <option value="HALF">Half Day ‚Çπ200</option>
          <option value="FULL">Full Day ‚Çπ400</option>
          <option value="OUTDOOR">Outdoor ‚Çπ450</option>
          <option value="CUSTOM">Custom Amount</option>
        </select>
      </div>
      <div *ngIf="workerType === 'CUSTOM'" class="form-group">
        <label>Amount (‚Çπ)</label>
        <input type="number" [(ngModel)]="customWorkerAmount" placeholder="Enter amount" class="form-input">
      </div>
      <button (click)="addWorker()" class="add-btn">‚ûï Add Worker</button>
    </div>
    <div *ngIf="order.labour_json.length > 0" class="labour-list">
      <h4>Workers Added</h4>
      <table class="labour-table">
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Amount</th>
          <th></th>
        </tr>
        <tr *ngFor="let worker of order.labour_json; let i = index">
          <td>{{ worker.name }}</td>
          <td>{{ worker.type }}</td>
          <td class="amount">‚Çπ{{ worker.amount }}</td>
          <td><button (click)="removeWorker(i)" class="remove-btn">‚ùå</button></td>
        </tr>
      </table>
      <div class="info-box">
        <p>Total Workers: <strong>{{ order.labour_json.length }}</strong></p>
        <p>Labour Total: <strong>‚Çπ{{ order.labour_total | number: '1.0-0' }}</strong></p>
      </div>
    </div>
    <div class="tab-buttons">
      <button class="prev-btn" (click)="activeTab = 'production'">‚Üê Back</button>
      <button class="next-btn" (click)="activeTab = 'charges'">Next ‚Üí</button>
    </div>
  </div>

  <!-- CHARGES TAB -->
  <div *ngIf="activeTab === 'charges'" class="card">
    <h3>ADDITIONAL CHARGES</h3>
    <div class="form-group">
      <label><input type="checkbox" [(ngModel)]="order.transport_charge" (change)="order.transport_charge = order.transport_charge ? order.transport_charge : 0"> Transport Charge</label>
      <input type="number" [(ngModel)]="order.transport_charge" (change)="updateTotals()" [disabled]="!order.transport_charge" placeholder="Enter amount" class="form-input">
    </div>
    <div class="form-group">
      <label><input type="checkbox" [(ngModel)]="order.installation_charge" (change)="order.installation_charge = order.installation_charge ? order.installation_charge : 0"> Installation Charge</label>
      <input type="number" [(ngModel)]="order.installation_charge" (change)="updateTotals()" [disabled]="!order.installation_charge" placeholder="Enter amount" class="form-input">
    </div>
    <div class="form-group">
      <label>Other Charges</label>
      <input type="number" [(ngModel)]="order.other_charge" (change)="updateTotals()" placeholder="Enter amount" class="form-input">
    </div>
    <div class="form-group">
      <label>Notes / Remarks</label>
      <textarea [(ngModel)]="order.notes" placeholder="Special instructions or notes" class="form-input" rows="3"></textarea>
    </div>
    <div class="info-box">
      <p>Transport: <strong>‚Çπ{{ order.transport_charge || 0 | number: '1.0-0' }}</strong></p>
      <p>Installation: <strong>‚Çπ{{ order.installation_charge || 0 | number: '1.0-0' }}</strong></p>
      <p>Other: <strong>‚Çπ{{ order.other_charge || 0 | number: '1.0-0' }}</strong></p>
    </div>
    <div class="tab-buttons">
      <button class="prev-btn" (click)="activeTab = 'labour'">‚Üê Back</button>
      <button class="next-btn" (click)="activeTab = 'payment'">Next ‚Üí</button>
    </div>
  </div>

  <!-- PAYMENT TAB -->
  <div *ngIf="activeTab === 'payment'" class="card">
    <h3>PAYMENT DETAILS</h3>
    <div class="bill-breakdown">
      <h4>Bill Summary</h4>
      <div class="breakdown-row">
        <span>Production:</span>
        <strong>‚Çπ{{ order.production_total | number: '1.0-0' }}</strong>
      </div>
      <div class="breakdown-row">
        <span>Labour:</span>
        <strong>‚Çπ{{ order.labour_total | number: '1.0-0' }}</strong>
      </div>
      <div class="breakdown-row">
        <span>Transport:</span>
        <strong>‚Çπ{{ order.transport_charge || 0 | number: '1.0-0' }}</strong>
      </div>
      <div class="breakdown-row">
        <span>Installation:</span>
        <strong>‚Çπ{{ order.installation_charge || 0 | number: '1.0-0' }}</strong>
      </div>
      <div class="breakdown-row">
        <span>Other:</span>
        <strong>‚Çπ{{ order.other_charge || 0 | number: '1.0-0' }}</strong>
      </div>
      <div class="breakdown-row total">
        <span>TOTAL BILL:</span>
        <strong>‚Çπ{{ order.total_bill | number: '1.0-0' }}</strong>
      </div>
    </div>
    <div class="payment-section">
      <h4>Payment Collection</h4>
      <div class="form-group">
        <label>Paid Amount (‚Çπ)</label>
        <input type="number" [(ngModel)]="order.paid_amount" (change)="updateTotals()" placeholder="Enter paid amount" class="form-input">
      </div>
      <div class="form-group">
        <label>Payment Mode</label>
        <select [(ngModel)]="order.payment_mode" class="form-select">
          <option value="Cash">Cash</option>
          <option value="UPI">UPI</option>
          <option value="Bank">Bank Transfer</option>
        </select>
      </div>
      <div class="due-section" [class.has-due]="order.due_amount > 0">
        <p>DUE AMOUNT:</p>
        <p class="due-amount">‚Çπ{{ order.due_amount | number: '1.0-0' }}</p>
      </div>
    </div>
    <div class="tab-buttons">
      <button class="prev-btn" (click)="activeTab = 'charges'">‚Üê Back</button>
      <button [disabled]="loading" (click)="saveOrder()" class="save-btn">{{ loading ? '‚è≥ Saving...' : 'üíæ Save Order' }}</button>
    </div>
  </div>

  <!-- ORDER HISTORY -->
  <div *ngIf="showHistory" class="card history-card">
    <h3>üìã Recent Orders</h3>
    <p *ngIf="orderHistory.length === 0" class="empty-state">No orders yet</p>
    <table *ngIf="orderHistory.length > 0" class="history-table">
      <tr>
        <th>Date</th>
        <th>Client</th>
        <th>Items</th>
        <th>Workers</th>
        <th>Bill</th>
        <th>Due</th>
      </tr>
      <tr *ngFor="let o of orderHistory">
        <td>{{ formatDateToDDMMYYYY(o.date) }}</td>
        <td>{{ o.client_name }}</td>
        <td>{{ o.production_total > 0 ? o.production_total + ' items' : '-' }}</td>
        <td>{{ o.labour_json?.length || 0 }}</td>
        <td class="amount">‚Çπ{{ o.total_bill | number: '1.0-0' }}</td>
        <td class="due" [class.has-due]="o.due_amount > 0">‚Çπ{{ o.due_amount | number: '1.0-0' }}</td>
      </tr>
    </table>
  </div>

</div>
