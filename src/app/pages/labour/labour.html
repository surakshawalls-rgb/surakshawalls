<div class="labour-container">

  <div class="top-bar">
    <h2>{{ language === 'EN' ? 'ЁЯС╖ Labour Attendance' : 'ЁЯС╖ рдордЬрджреВрд░ рдЙрдкрд╕реНрдерд┐рддрд┐' }}</h2>
    <button class="lang-btn" (click)="toggleLang()">ЁЯМР {{language}}</button>
  </div>

  <label>{{ language === 'EN' ? 'Date' : 'рддрд╛рд░реАрдЦ' }}</label>
  <input type="date" [(ngModel)]="date">

  <!-- Add Labour -->
  <div class="card">
    <h3>{{ language === 'EN' ? 'Add Labour' : 'рдордЬрджреВрд░ рдЬреЛрдбрд╝реЗрдВ' }}</h3>

    <input [placeholder]="language==='EN' ? 'Name' : 'рдирд╛рдо'" [(ngModel)]="newWorker">

    <select [(ngModel)]="workerType">
      <option value="HALF">{{ language==='EN' ? 'Half Day тВ╣200' : 'рдЖрдзрд╛ рджрд┐рди тВ╣200' }}</option>
      <option value="FULL">{{ language==='EN' ? 'Full Day тВ╣400' : 'рдкреВрд░рд╛ рджрд┐рди тВ╣400' }}</option>
      <option value="OUTDOOR">{{ language==='EN' ? 'Outdoor тВ╣450' : 'рдмрд╛рд╣рд░ рдХрд╛рдо тВ╣450' }}</option>
      <option value="CUSTOM">{{ language==='EN' ? 'Custom Amount' : 'рдХрд╕реНрдЯрдо рд░рд╛рд╢рд┐' }}</option>
    </select>

    @if(workerType==='CUSTOM'){
      <input type="number" [placeholder]="language==='EN' ? 'Enter Amount' : 'рд░рд╛рд╢рд┐ рдбрд╛рд▓реЗрдВ'" [(ngModel)]="customWorkerAmount">
    }

    <button (click)="addWorker()">тЮХ {{ language==='EN' ? 'Add' : 'рдЬреЛрдбрд╝реЗрдВ' }}</button>
  </div>

  <!-- Draft Labour Table -->
  <div class="card" *ngIf="workers.length">
    <h3>{{ language==='EN' ? 'Draft Labour (Not Saved)' : 'рдЕрд╕реНрдерд╛рдпреА рдордЬрджреВрд░ рд╕реВрдЪреА' }}</h3>

    <table class="labour-table">
      <tr>
        <th>{{language==='EN'?'Name':'рдирд╛рдо'}}</th>
        <th>{{language==='EN'?'Type':'рдкреНрд░рдХрд╛рд░'}}</th>
        <th>{{language==='EN'?'Amount':'рд░рд╛рд╢рд┐'}}</th>
        <th></th>
      </tr>

      @for(w of workers; track $index){
        <tr>
          <td>{{w.name}}</td>
          <td>{{w.type}}</td>
          <td>тВ╣{{w.amount}}</td>
          <td><button (click)="removeWorker($index)">тЭМ</button></td>
        </tr>
      }
    </table>
  </div>

  <button class="save-btn" (click)="saveToDatabase()">
    ЁЯТ╛ {{ language==='EN' ? 'Save to Database' : 'рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗрдВ' }}
  </button>

  <!-- Filters -->
  <div class="filters">
    <input [placeholder]="language==='EN' ? 'Search Name' : 'рдирд╛рдо рдЦреЛрдЬреЗрдВ'" [(ngModel)]="searchName" (input)="applyFilter()">
    <input type="date" [(ngModel)]="filterDate" (change)="applyFilter()">
    <button (click)="refreshTable()">ЁЯФД {{language==='EN'?'Refresh':'рд░рд┐рдлреНрд░реЗрд╢'}}</button>
    <button (click)="exportCSV()">ЁЯУе CSV</button>
  </div>

  <h3>
    ЁЯУЕ {{ language==='EN' ? 'Monthly Total Expense' : 'рдорд╛рд╕рд┐рдХ рдХреБрд▓ рдЦрд░реНрдЪ' }}: тВ╣{{monthlyTotal}}
  </h3>

  <!-- DB Table -->
  <table class="labour-table">
    <tr>
      <th>{{language==='EN'?'Date':'рддрд╛рд░реАрдЦ'}}</th>
      <th>{{language==='EN'?'Name':'рдирд╛рдо'}}</th>
      <th>{{language==='EN'?'Type':'рдкреНрд░рдХрд╛рд░'}}</th>
      <th>{{language==='EN'?'Amount':'рд░рд╛рд╢рд┐'}}</th>
    </tr>

    @for(r of filteredRecords; track $index){
      <tr>
        <td>{{formatDateToDDMMYYYY(r.date)}}</td>
        <td>{{r.name}}</td>
        <td>{{r.type}}</td>
        <td>тВ╣{{r.amount}}</td>
      </tr>
    }
  </table>

  <!-- Pagination -->
  <div class="pagination">
    <button (click)="prevPage()">тмЕ {{language==='EN'?'Prev':'рдкрд┐рдЫрд▓рд╛'}}</button>
    <span>Page {{page+1}}</span>
    <button (click)="nextPage()">{{language==='EN'?'Next':'рдЕрдЧрд▓рд╛'}} тЮб</button>
  </div>

</div>

<div *ngIf="loading" class="loader-overlay">
  <div class="loader-box">тП│ Loading...</div>
</div>

