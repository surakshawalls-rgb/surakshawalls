<!-- src/app/pages/sales-entry/sales-entry.component.html -->
<div class="sales-entry-container">
  <div class="header">
    <h2>Sales Entry</h2>
    <p class="subtitle">Record new sale transaction</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">Loading data...</div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Sales Form -->
  <div class="form-card" *ngIf="!loading">
    
    <!-- Date -->
    <div class="form-group">
      <label>Date <span class="required">*</span></label>
      <input type="date" [(ngModel)]="date" class="form-control">
    </div>

    <!-- Client Selection with Search -->
    <div class="form-group">
      <label>Client <span class="required">*</span></label>
      <div class="client-search-wrapper">
        <input 
          type="text" 
          [(ngModel)]="clientSearchTerm" 
          (input)="filterClients()"
          (focus)="showClientDropdown = true"
          placeholder="Search client by name or phone"
          class="form-control">
        
        <div class="client-dropdown" *ngIf="showClientDropdown && filteredClients.length > 0">
          <div 
            *ngFor="let client of filteredClients" 
            class="client-dropdown-item"
            (click)="selectClient(client)">
            <div class="client-name">{{ client.client_name }}</div>
            <div class="client-info">
              {{ client.phone }} | Outstanding: ₹{{ client.outstanding }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Selection -->
    <div class="form-group">
      <label>Product <span class="required">*</span></label>
      <select [(ngModel)]="productName" (change)="onProductChange()" class="form-control">
        <option value="">Select Product</option>
        <option *ngFor="let product of products" [value]="product.product_name">
          {{ product.product_name }} (Stock: {{ product.stock }})
        </option>
      </select>
      <div *ngIf="currentStock > 0" class="stock-indicator">
        Available Stock: <strong>{{ currentStock }} units</strong>
      </div>
      <div *ngIf="productName && currentStock === 0" class="stock-indicator out-of-stock">
        ⚠️ Out of Stock
      </div>
    </div>

    <!-- Quantity and Rate -->
    <div class="form-row">
      <div class="form-group">
        <label>Quantity <span class="required">*</span></label>
        <input 
          type="number" 
          [(ngModel)]="quantity" 
          (input)="onQuantityChange()"
          min="0"
          class="form-control"
          [class.invalid]="quantity > currentStock">
        <div *ngIf="quantity > currentStock" class="error-text">
          Insufficient stock
        </div>
      </div>

      <div class="form-group">
        <label>Rate (₹) <span class="required">*</span></label>
        <input 
          type="number" 
          [(ngModel)]="rate" 
          (input)="onRateChange()"
          min="0"
          class="form-control">
      </div>
    </div>

    <!-- Total Amount -->
    <div class="total-section">
      <div class="total-label">Total Amount</div>
      <div class="total-amount">₹{{ totalAmount }}</div>
    </div>

    <!-- Payment Details -->
    <div class="section-header">Payment Details</div>

    <div class="form-group">
      <label>Payment Type <span class="required">*</span></label>
      <div class="payment-types">
        <label class="radio-label">
          <input 
            type="radio" 
            [(ngModel)]="paymentType" 
            value="full"
            (change)="onPaymentTypeChange()">
          <span>Full Payment</span>
        </label>
        <label class="radio-label">
          <input 
            type="radio" 
            [(ngModel)]="paymentType" 
            value="partial"
            (change)="onPaymentTypeChange()">
          <span>Partial Payment</span>
        </label>
        <label class="radio-label">
          <input 
            type="radio" 
            [(ngModel)]="paymentType" 
            value="credit"
            (change)="onPaymentTypeChange()">
          <span>Credit (No Payment)</span>
        </label>
      </div>
    </div>

    <div class="form-group" *ngIf="paymentType !== 'credit'">
      <label>Payment Amount (₹) <span class="required">*</span></label>
      <input 
        type="number" 
        [(ngModel)]="paymentAmount" 
        min="0"
        [max]="totalAmount"
        class="form-control"
        [class.invalid]="paymentAmount > totalAmount">
      <div *ngIf="paymentAmount > totalAmount" class="error-text">
        Payment cannot exceed total amount
      </div>
    </div>

    <!-- Cash Management -->
    <div class="section-header">Cash Management</div>

    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="depositedToFirm">
        <span>Deposited to Firm Cash</span>
      </label>
      <div class="help-text">
        Check if payment is deposited to office cash pool
      </div>
    </div>

    <div class="form-group" *ngIf="!depositedToFirm">
      <label>Collected By Partner</label>
      <select [(ngModel)]="collectedByPartnerId" class="form-control">
        <option [value]="null">Select Partner</option>
        <option *ngFor="let partner of partners" [value]="partner.id">
          {{ partner.partner_name }}
        </option>
      </select>
    </div>

    <!-- Delivery Status -->
    <div class="form-group">
      <label>Delivery Status</label>
      <select [(ngModel)]="deliveryStatus" class="form-control">
        <option value="pending">Pending</option>
        <option value="delivered">Delivered</option>
      </select>
    </div>

    <!-- Notes -->
    <div class="form-group">
      <label>Notes</label>
      <textarea 
        [(ngModel)]="notes" 
        rows="3"
        placeholder="Additional notes (optional)"
        class="form-control"></textarea>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button 
        (click)="saveSale()" 
        [disabled]="!isFormValid() || saving"
        class="btn btn-primary">
        <span *ngIf="!saving">Save Sale</span>
        <span *ngIf="saving">Saving...</span>
      </button>
      <button 
        (click)="resetForm()" 
        class="btn btn-secondary"
        [disabled]="saving">
        Reset
      </button>
    </div>

  </div>
</div>
