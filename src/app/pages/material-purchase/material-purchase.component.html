<!-- src/app/pages/material-purchase/material-purchase.component.html -->
<style>
@keyframes pulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; }
}
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-8px); }
}
@keyframes gradientFlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
</style>

<div style="min-height: 100vh; background: linear-gradient(135deg, #f093fb 0%, #f5576c 25%, #4facfe 50%, #00f2fe 75%, #667eea 100%); background-size: 400% 400%; animation: gradientFlow 15s ease infinite; padding: 24px;">

  <!-- Modern Header -->
  <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px; text-align: center;">
    <h2 style="margin: 0; font-size: 2.2rem; font-weight: 700; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; gap: 16px;">
      <span style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 16px; animation: float 3s ease-in-out infinite;">ğŸ“¦</span>
      Material Purchase
    </h2>
    <p style="margin: 16px 0 0 0; color: rgba(255,255,255,0.8); font-size: 1.1rem; font-weight: 500;">Record raw material purchases</p>
  </div>

  <!-- Loading & Messages -->
  <div *ngIf="loading" 
       style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div style="background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); padding: 40px; border-radius: 24px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.3);">
      <div style="width: 50px; height: 50px; border: 4px solid #e5e7eb; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
      <div style="font-size: 1.2rem; font-weight: 600; color: #374151;">Loading...</div>
    </div>
  </div>
  
  <div *ngIf="successMessage" 
       style="backdrop-filter: blur(20px); background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9)); border-radius: 16px; padding: 20px; margin-bottom: 24px; color: white; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3); border: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 12px;">
    <span style="font-size: 1.4rem;">âœ…</span>
    <span style="font-weight: 600;">{{ successMessage }}</span>
  </div>
  
  <div *ngIf="errorMessage" 
       style="backdrop-filter: blur(20px); background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9)); border-radius: 16px; padding: 20px; margin-bottom: 24px; color: white; box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3); border: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 12px;">
    <span style="font-size: 1.4rem;">âš ï¸</span>
    <span style="font-weight: 600;">{{ errorMessage }}</span>
  </div>

  <div *ngIf="!loading" style="display: grid; grid-template-columns: 1fr 400px; gap: 32px; align-items: start;">
    <!-- Purchase Form -->
    <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px;">
      <h3 style="margin: 0 0 32px 0; color: white; font-size: 1.6rem; font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px;">
        <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 12px; font-size: 1.2rem;">ğŸ“</span>
        New Purchase
      </h3>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="color: white; font-weight: 600; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 6px;">
            <span style="color: #10b981;">ğŸ“…</span> Date <span style="color: #ef4444;">*</span>
          </label>
          <input type="date" [(ngModel)]="date" 
                 style="padding: 16px 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 16px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                 onfocus="this.style.borderColor='rgba(255,255,255,0.6)'; this.style.boxShadow='0 0 0 3px rgba(255,255,255,0.2)'"
                 onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
        </div>

        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="color: white; font-weight: 600; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 6px;">
            <span style="color: #8b5cf6;">ğŸ“‹</span> Material <span style="color: #ef4444;">*</span>
          </label>
          <select [(ngModel)]="materialName" (change)="onMaterialChange()" 
                  style="padding: 16px 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 16px; background: rgba(255,255,255,0.9); font-size: 1rem; cursor: pointer; transition: all 0.3s ease;"
                  onfocus="this.style.borderColor='rgba(255,255,255,0.6)'; this.style.boxShadow='0 0 0 3px rgba(255,255,255,0.2)'"
                  onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
            <option value="">Select Material</option>
            <option *ngFor="let material of materials" [value]="material.material_name">
              {{ material.material_name }} (Stock: {{ material.current_stock }} {{ material.unit }})
            </option>
          </select>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="color: white; font-weight: 600; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 6px;">
            <span style="color: #f59e0b;">ğŸ“Š</span> Quantity <span style="color: #ef4444;">*</span>
          </label>
          <input type="number" [(ngModel)]="quantity" (input)="onQuantityChange()" min="0" 
                 style="padding: 16px 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 16px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                 onfocus="this.style.borderColor='rgba(255,255,255,0.6)'; this.style.boxShadow='0 0 0 3px rgba(255,255,255,0.2)'"
                 onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
        </div>
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="color: white; font-weight: 600; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 6px;">
            <span style="color: #10b981;">ğŸ’°</span> Unit Cost (â‚¹) <span style="color: #ef4444;">*</span>
          </label>
          <input type="number" [(ngModel)]="unitCost" (input)="onUnitCostChange()" min="0" 
                 style="padding: 16px 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 16px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                 onfocus="this.style.borderColor='rgba(255,255,255,0.6)'; this.style.boxShadow='0 0 0 3px rgba(255,255,255,0.2)'"
                 onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
        </div>
      </div>

      <!-- Total Amount Display -->
      <div style="background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1)); border-radius: 16px; padding: 20px; margin-bottom: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.3);">
        <div style="color: rgba(255,255,255,0.8); font-size: 0.95rem; margin-bottom: 8px;">Total Amount</div>
        <div style="color: white; font-size: 2rem; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">â‚¹{{ totalAmount | number }}</div>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; gap: 16px; justify-content: center;">
        <button (click)="savePurchase()" [disabled]="!isFormValid() || saving" 
                style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 16px 32px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); display: flex; align-items: center; gap: 8px;"
                [style.opacity]="!isFormValid() || saving ? '0.6' : '1'"
                [style.cursor]="!isFormValid() || saving ? 'not-allowed' : 'pointer'"
                onmouseover="if(!this.disabled) { this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(16, 185, 129, 0.5)'; }"
                onmouseout="if(!this.disabled) { this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.4)'; }">
          <span *ngIf="saving" style="width: 16px; height: 16px; border: 2px solid white; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></span>
          {{ saving ? 'Saving...' : 'ğŸ’¾ Save Purchase' }}
        </button>
        <button (click)="resetForm()" 
                style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 16px 32px; border-radius: 50px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px);"
                onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-3px)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'">
          ğŸ”„ Reset
        </button>
      </div>
    </div>

    <!-- Recent Purchases Sidebar -->
    <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px;">
      <h3 style="margin: 0 0 24px 0; color: white; font-size: 1.4rem; font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px;">
        <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 12px; font-size: 1.1rem;">ğŸ“‹</span>
        Recent Purchases
      </h3>
      <div style="display: flex; flex-direction: column; gap: 16px; max-height: 600px; overflow-y: auto;">
        <div *ngFor="let purchase of purchaseHistory" 
             style="background: rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s ease;"
             onmouseover="this.style.transform='translateY(-2px)'; this.style.background='rgba(255,255,255,0.15)'"
             onmouseout="this.style.transform='translateY(0)'; this.style.background='rgba(255,255,255,0.1)'">
          <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 12px;">
            <div style="color: white; font-weight: 700; font-size: 1.1rem;">{{ purchase.material_name }}</div>
            <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 4px 12px; border-radius: 20px; font-weight: 600; font-size: 0.9rem;">â‚¹{{ purchase.total_amount | number }}</div>
          </div>
          <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 8px;">
            {{ purchase.date }} â€¢ {{ purchase.quantity }} units @ â‚¹{{ purchase.unit_cost }}
          </div>
          <div style="color: rgba(255,255,255,0.7); font-size: 0.85rem; font-style: italic;">
            {{ purchase.paid_from === 'office_cash' ? 'ğŸ¢ Office Cash' : 'ğŸ‘¤ Partner Pocket' }}
          </div>
        </div>
        <div *ngIf="purchaseHistory.length === 0" 
             style="background: rgba(255,255,255,0.05); border-radius: 16px; padding: 40px; text-align: center; color: rgba(255,255,255,0.6); backdrop-filter: blur(10px);">
          <div style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;">ğŸ“¦</div>
          <div style="font-size: 1.1rem;">No recent purchases</div>
        </div>
      </div>
    </div>
  </div>
</div>
