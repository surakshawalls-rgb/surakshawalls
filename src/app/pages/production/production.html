<div class="prod-container">

  <div class="top-bar">
    <h2>{{ language==='EN' ? 'üè≠ Production & Selling' : 'üè≠ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§î‡§∞ ‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø' }}</h2>
    <button class="lang-btn" (click)="toggleLang()">üåê {{language}}</button>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      [class.active]="activeTab === 'production'"
      (click)="activeTab = 'production'"
      class="tab-btn">
      üè≠ {{language==='EN'?'Production':'‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®'}}
    </button>
    <button 
      [class.active]="activeTab === 'selling'"
      (click)="activeTab = 'selling'"
      class="tab-btn">
      üí∞ {{language==='EN'?'Selling':'‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø'}}
    </button>
    <button 
      [class.active]="activeTab === 'damage'"
      (click)="activeTab = 'damage'"
      class="tab-btn">
      ‚ö†Ô∏è {{language==='EN'?'Damage':'‡§ï‡•ç‡§∑‡§§‡§ø'}}
    </button>
  </div>

  <!-- PRODUCTION TAB -->
  @if(activeTab === 'production') {
    <div class="tab-content">

      <label>{{language==='EN'?'Date':'‡§§‡§æ‡§∞‡•Ä‡§ñ'}}</label>
      <input type="date" [(ngModel)]="date">

      <!-- Counters -->
      <div class="card" *ngFor="let item of items">
        <span>{{ language==='EN'?item.labelEN:item.labelHI }}</span>

        <div class="counter">
          <button (click)="dec(item.key)">‚ûñ</button>
          <span>{{production[item.key]}}</span>
          <button (click)="inc(item.key)">‚ûï</button>
        </div>
      </div>

      <button class="save-btn" (click)="saveProduction()">üíæ Save Production</button>

      <!-- Filters -->
      <div class="filters">
        <input type="date" [(ngModel)]="filterDate" (change)="applyFilter()">
        <button (click)="refreshTable()">üîÑ Reload</button>
      </div>

      <!-- Table -->
      <table class="prod-table">
        <tr>
          <th>Date</th>
          <th>Fencing</th>
          <th>Plain</th>
          <th>Jumbo</th>
          <th>Round</th>
          <th>Biscuit</th>
          <th>Action</th>
        </tr>

        @for(r of filtered; track $index){
          <tr>
            <td>{{formatDateToDDMMYYYY(r.date)}}</td>
            <td>{{r.fencing_pole}}</td>
            <td>{{r.plain_plate}}</td>
            <td>{{r.jumbo_pillar}}</td>
            <td>{{r.round_plate}}</td>
            <td>{{r.biscuit_plate}}</td>
            <td>
              <button class="delete-btn" (click)="deleteProduction(r.id)" title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </table>

      <!-- Pagination -->
      <div class="pagination">
        <button (click)="prevPage()">‚¨Ö Prev</button>
        <span>Page {{page+1}}</span>
        <button (click)="nextPage()">Next ‚û°</button>
      </div>

    </div>
  }

  <!-- SELLING TAB -->
  @if(activeTab === 'selling') {
    <div class="tab-content">

      <h3>{{language==='EN'?'Record Sale':'‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°'}}</h3>

      <label>{{language==='EN'?'Date':'‡§§‡§æ‡§∞‡•Ä‡§ñ'}}</label>
      <input type="date" [(ngModel)]="sellingDate">

      <label>{{language==='EN'?'Client Name':'‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ'}}</label>
      <input type="text" [(ngModel)]="sellingClient" [placeholder]="language==='EN'?'Client name':'‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ'">

      <label>{{language==='EN'?'Item Type':'‡§Ü‡§á‡§ü‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞'}}</label>
      <select [(ngModel)]="sellingItem">
        <option value="fencingPole">Fencing Pole</option>
        <option value="plainPlate">Plain Plate</option>
        <option value="jumboPillar">Jumbo Pillar</option>
        <option value="roundPlate">Round Plate</option>
        <option value="biscuitPlate">Biscuit Plate</option>
      </select>

      <label>{{language==='EN'?'Quantity':'‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ'}}</label>
      <input type="number" [(ngModel)]="sellingQuantity" [placeholder]="language==='EN'?'Quantity':'‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ'">

      <label>{{language==='EN'?'Price (per unit)':'‡§ï‡•Ä‡§Æ‡§§ (‡§™‡•ç‡§∞‡§§‡§ø ‡§á‡§ï‡§æ‡§à)'}}</label>
      <input type="number" [(ngModel)]="sellingPrice" [placeholder]="language==='EN'?'Price':'‡§ï‡•Ä‡§Æ‡§§'">

      <button class="save-btn" (click)="saveSelling()">üíæ {{language==='EN'?'Save Sale':'‡§¨‡§ø‡§ï‡•ç‡§∞‡§Ø ‡§∏‡§π‡•á‡§ú‡•á‡§Ç'}}</button>

      <!-- Selling Records Table -->
      <h3>{{language==='EN'?'Sales Records':'‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°'}}</h3>
      <table class="prod-table">
        <tr>
          <th>Date</th>
          <th>Client</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
        @for(s of sellingRecords; track $index){
          <tr>
            <td>{{formatDateToDDMMYYYY(s.date)}}</td>
            <td>{{s.client}}</td>
            <td>{{s.item}}</td>
            <td>{{s.quantity}}</td>
            <td>‚Çπ{{s.price}}</td>
            <td>‚Çπ{{s.quantity * s.price}}</td>
            <td>
              <button class="delete-btn" (click)="deleteSelling(s.id)" title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </table>

    </div>
  }

  <!-- DAMAGE TAB -->
  @if(activeTab === 'damage') {
    <div class="tab-content">

      <h3>{{language==='EN'?'Record Damage':'‡§ï‡•ç‡§∑‡§§‡§ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°'}}</h3>

      <label>{{language==='EN'?'Date':'‡§§‡§æ‡§∞‡•Ä‡§ñ'}}</label>
      <input type="date" [(ngModel)]="damageDate">

      <label>{{language==='EN'?'Item Type':'‡§Ü‡§á‡§ü‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞'}}</label>
      <select [(ngModel)]="damageItem">
        <option value="fencingPole">Fencing Pole</option>
        <option value="plainPlate">Plain Plate</option>
        <option value="jumboPillar">Jumbo Pillar</option>
        <option value="roundPlate">Round Plate</option>
        <option value="biscuitPlate">Biscuit Plate</option>
      </select>

      <label>{{language==='EN'?'Quantity Damaged':'‡§ï‡•ç‡§∑‡§§‡§ø‡§ó‡•ç‡§∞‡§∏‡•ç‡§§ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ'}}</label>
      <input type="number" [(ngModel)]="damageQuantity" [placeholder]="language==='EN'?'Quantity':'‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ'">

      <label>{{language==='EN'?'Reason':'‡§ï‡§æ‡§∞‡§£'}}</label>
      <input type="text" [(ngModel)]="damageReason" [placeholder]="language==='EN'?'Reason for damage':'‡§ï‡•ç‡§∑‡§§‡§ø ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£'">

      <button class="save-btn" (click)="saveDamage()">‚ö†Ô∏è {{language==='EN'?'Record Damage':'‡§ï‡•ç‡§∑‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç'}}</button>

      <!-- Damage Records Table -->
      <h3>{{language==='EN'?'Damage Records':'‡§ï‡•ç‡§∑‡§§‡§ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°'}}</h3>
      <table class="prod-table">
        <tr>
          <th>Date</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Reason</th>
          <th>Action</th>
        </tr>
        @for(d of damageRecords; track $index){
          <tr>
            <td>{{formatDateToDDMMYYYY(d.date)}}</td>
            <td>{{d.item}}</td>
            <td>{{d.quantity}}</td>
            <td>{{d.reason}}</td>
            <td>
              <button class="delete-btn" (click)="deleteDamage(d.id)" title="Delete">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </table>

    </div>
  }

</div>

<div *ngIf="loading" class="loader-overlay">
  <div class="loader-box">‚è≥ Loading...</div>
</div>

