<div style="min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%); background-attachment: fixed; padding: 20px; position: relative; overflow-x: auto;">
  <!-- Animated Background Pattern -->
  <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: 
    radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
    linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 70%);
    animation: gradientFlow 15s ease-in-out infinite; z-index: 0;"></div>

  <div style="position: relative; z-index: 1; max-width: 1400px; margin: 0 auto;">
    <!-- Header -->
    <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h2 style="margin: 0; color: white; font-size: 2rem; font-weight: 800; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 16px;">
            <span style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 16px; font-size: 1.5rem; animation: pulse 2s ease-in-out infinite;">ü§ù</span>
            {{ language==='EN'?'Partner Management':'‡§™‡§æ‡§∞‡•ç‡§ü‡§®‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®' }}
          </h2>
          <p style="margin: 8px 0 0 60px; color: rgba(255,255,255,0.8); font-size: 1.1rem; font-weight: 500;">{{ language==='EN'?'Manage partner expenses and transactions':'‡§™‡§æ‡§∞‡•ç‡§ü‡§®‡§∞ ‡§ñ‡§∞‡•ç‡§ö ‡§î‡§∞ ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç' }}</p>
        </div>
        <button (click)="toggleLang()"
                style="padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.4); border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;"
                onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-1px)'"
                onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'">
          <span style="font-size: 1.1rem;">üåê</span>
          {{ language }}
        </button>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 8px; margin-bottom: 32px; display: flex; gap: 8px;">
      <button [class.active]="activeTab === 'ledger'" (click)="activeTab = 'ledger'"
              style="flex: 1; padding: 16px 24px; border: none; border-radius: 16px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;"
              [style.background]="activeTab === 'ledger' ? 'rgba(255,255,255,0.9)' : 'transparent'"
              [style.color]="activeTab === 'ledger' ? '#374151' : 'white'"
              [style.transform]="activeTab === 'ledger' ? 'translateY(-2px)' : 'translateY(0)'"
              [style.boxShadow]="activeTab === 'ledger' ? '0 8px 25px rgba(255,255,255,0.3)' : 'none'"
              onmouseover="if(this.style.background !== 'rgba(255,255,255,0.9)') { this.style.background='rgba(255,255,255,0.1)'; }"
              onmouseout="if(this.style.background !== 'rgba(255,255,255,0.9)') { this.style.background='transparent'; }">
        <span style="font-size: 1.1rem;">üìã</span>
        {{ language==='EN'?'Ledger':'‡§≤‡•á‡§ú‡§∞' }}
      </button>
      <button [class.active]="activeTab === 'withdraw'" (click)="activeTab = 'withdraw'"
              style="flex: 1; padding: 16px 24px; border: none; border-radius: 16px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;"
              [style.background]="activeTab === 'withdraw' ? 'rgba(255,255,255,0.9)' : 'transparent'"
              [style.color]="activeTab === 'withdraw' ? '#374151' : 'white'"
              [style.transform]="activeTab === 'withdraw' ? 'translateY(-2px)' : 'translateY(0)'"
              [style.boxShadow]="activeTab === 'withdraw' ? '0 8px 25px rgba(255,255,255,0.3)' : 'none'"
              onmouseover="if(this.style.background !== 'rgba(255,255,255,0.9)') { this.style.background='rgba(255,255,255,0.1)'; }"
              onmouseout="if(this.style.background !== 'rgba(255,255,255,0.9)') { this.style.background='transparent'; }">
        <span style="font-size: 1.1rem;">üí∏</span>
        {{ language==='EN'?'Withdraw':'‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä' }}
      </button>
    </div>

    <!-- LEDGER TAB -->
    @if(activeTab === 'ledger') {
    <div style="animation: fadeInUp 0.5s ease-out;">

      <!-- Date -->
      <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 32px;">
        <label style="display: block; color: white; font-weight: 600; margin-bottom: 12px; font-size: 1.1rem;">{{ language==='EN'?'Date':'‡§§‡§æ‡§∞‡•Ä‡§ñ' }}</label>
        <input type="date" [(ngModel)]="date"
               style="width: 300px; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; font-weight: 600; transition: all 0.3s ease;"
               onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
               onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
      </div>

      <!-- Add Expense Card -->
      <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px;">
        <h3 style="margin: 0 0 32px 0; color: white; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 12px;">
          <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 12px; font-size: 1.2rem;">üí∞</span>
          {{ language==='EN'?'Add Partner Expense':'‡§™‡§æ‡§∞‡•ç‡§ü‡§®‡§∞ ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§º‡•á‡§Ç' }}
        </h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 24px;">
          <div>
            <label style="display: block; color: white; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;">Partner</label>
            <select [(ngModel)]="partnerId" (change)="onPartnerChange()"
                    style="width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                    onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
                    onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
              <option value="">Select Partner</option>
              <option *ngFor="let p of partners" [value]="p.id">{{ p.partner_name }}</option>
            </select>
          </div>

          <div>
            <label style="display: block; color: white; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;">Category</label>
            <select [(ngModel)]="category"
                    style="width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                    onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
                    onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
              <option value="Sariya">üî© Sariya</option>
              <option value="Cement">üì¶ Cement</option>
              <option value="Sand">üèñÔ∏è Sand</option>
              <option value="Gitti">ü™® Gitti</option>
              <option value="Diesel">‚õΩ Diesel</option>
              <option value="Snacks">üçø Snacks</option>
              <option value="Mobile">üì± Mobile</option>
              <option value="Maintenance">üîß Maintenance</option>
              <option value="Other">‚ùì Other</option>
            </select>
          </div>

          @if(category==='Other'){
            <div>
              <label style="display: block; color: white; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;">Custom Description</label>
              <input placeholder="Enter description" [(ngModel)]="otherDescription"
                     style="width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                     onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
                     onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
            </div>
          }

          <div>
            <label style="display: block; color: white; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;">{{ language==='EN'?'Reason':'‡§ï‡§æ‡§∞‡§£' }}</label>
            <input placeholder="{{ language==='EN'?'Enter reason':'‡§ï‡§æ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç' }}" [(ngModel)]="title"
                   style="width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                   onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
                   onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
          </div>

          <div>
            <label style="display: block; color: white; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;">{{ language==='EN'?'Amount':'‡§∞‡§æ‡§∂‡§ø' }}</label>
            <input type="number" placeholder="{{ language==='EN'?'Enter amount':'‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç' }}" [(ngModel)]="amount"
                   style="width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: rgba(255,255,255,0.9); font-size: 1rem; transition: all 0.3s ease;"
                   onfocus="this.style.borderColor='rgba(102, 126, 234, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.2)'"
                   onblur="this.style.borderColor='rgba(255,255,255,0.3)'; this.style.boxShadow='none'">
          </div>
        </div>

        <div style="text-align: right;">
          <button (click)="saveExpense()"
                  style="padding: 16px 32px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
            üíæ Save
          </button>
        </div>
      </div>

      <!-- Profit Share Card -->
      <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px;">
        <h3 style="margin: 0 0 32px 0; color: white; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 12px;">
          <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 12px; font-size: 1.2rem;">üìä</span>
          {{ language==='EN'?'Profit Share':'‡§≤‡§æ‡§≠ ‡§µ‡§ø‡§§‡§∞‡§£' }}
        </h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
          <div style="background: rgba(16, 185, 129, 0.2); padding: 20px; border-radius: 16px; text-align: center; border: 1px solid rgba(16, 185, 129, 0.3);">
            <div style="color: rgba(16, 185, 129, 1); font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Pradeep</div>
            <div style="color: white; font-size: 1.8rem; font-weight: 800;">‚Çπ{{ profitPradeep }}</div>
          </div>
          
          <div style="background: rgba(59, 130, 246, 0.2); padding: 20px; border-radius: 16px; text-align: center; border: 1px solid rgba(59, 130, 246, 0.3);">
            <div style="color: rgba(59, 130, 246, 1); font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Praveen</div>
            <div style="color: white; font-size: 1.8rem; font-weight: 800;">‚Çπ{{ profitPraveen }}</div>
          </div>
          
          <div style="background: rgba(245, 158, 11, 0.2); padding: 20px; border-radius: 16px; text-align: center; border: 1px solid rgba(245, 158, 11, 0.3);">
            <div style="color: rgba(245, 158, 11, 1); font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">Pappu</div>
            <div style="color: white; font-size: 1.8rem; font-weight: 800;">‚Çπ{{ profitPappu }}</div>
          </div>
        </div>
      </div>

      <!-- Partner Expenses Table -->
      <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px; margin-bottom: 32px;">
        <h3 style="margin: 0 0 32px 0; color: white; font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 12px;">
          <span style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 12px; font-size: 1.2rem;">üìí</span>
          {{ language==='EN'?'Partner Expenses':'‡§™‡§æ‡§∞‡•ç‡§ü‡§®‡§∞ ‡§ñ‡§∞‡•ç‡§ö ‡§∏‡•Ç‡§ö‡•Ä' }}
        </h3>

        <div style="overflow-x: auto; border-radius: 16px; background: rgba(255,255,255,0.05); margin-bottom: 24px;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: rgba(255,255,255,0.1);">
                <th style="padding: 16px; text-align: left; color: white; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2);">Date</th>
                <th style="padding: 16px; text-align: left; color: white; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2);">Partner</th>
                <th style="padding: 16px; text-align: left; color: white; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2);">Category</th>
                <th style="padding: 16px; text-align: left; color: white; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2);">Description</th>
                <th style="padding: 16px; text-align: left; color: white; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.2);">Amount</th>
              </tr>
            </thead>
            <tbody>
              @for(r of records; track $index){
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; animation: fadeInUp 0.3s ease-out;"
                    [style.animation-delay]="($index * 0.05) + 's'"
                    onmouseover="this.style.background='rgba(255,255,255,0.1)'"
                    onmouseout="this.style.background='transparent'">
                  <td style="padding: 16px; color: rgba(255,255,255,0.9); font-weight: 500;">{{ formatDateToDDMMYYYY(r.date) }}</td>
                  <td style="padding: 16px; color: white; font-weight: 600;">{{ r.partner_id }}</td>
                  <td style="padding: 16px;">
                    <span style="background: rgba(102, 126, 234, 0.8); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                      {{ r.category || '-' }}
                    </span>
                  </td>
                  <td style="padding: 16px; color: rgba(255,255,255,0.9);">{{ r.description }}</td>
                  <td style="padding: 16px; color: white; font-weight: 700; font-size: 1.1rem;">‚Çπ{{ r.amount }}</td>
                </tr>
              }
            </tbody>
          </table>

          <!-- No Data State -->
          <div *ngIf="records.length === 0" style="text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.6);">
            <div style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;">üìã</div>
            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 8px;">No Expenses Found</div>
            <div style="font-size: 0.9rem;">Partner expenses will appear here once added</div>
          </div>
        </div>

        <!-- Pagination -->
        <div style="display: flex; justify-content: center; align-items: center; gap: 16px;">
          <button (click)="prevPage()"
                  style="padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.4); border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;"
                  onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateX(-2px)'"
                  onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(0)'">
            ‚¨Ö Prev
          </button>

          <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 12px; color: white; font-weight: 600;">
            Page {{ page + 1 }}
          </div>

          <button (click)="nextPage()"
                  style="padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.4); border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;"
                  onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateX(2px)'"
                  onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(0)'">
            Next ‚û°
          </button>

          <button (click)="refreshTable()"
                  style="padding: 12px 20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.8), rgba(5, 150, 105, 0.8)); color: white; border: none; border-radius: 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
            üîÑ Refresh
          </button>
        </div>
      </div>

    </div>
    }

    <!-- WITHDRAW TAB -->
    @if(activeTab === 'withdraw') {
    <div style="animation: fadeInUp 0.5s ease-out;">
      <div style="backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border-radius: 24px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 32px;">
        <app-partner-withdraw></app-partner-withdraw>
      </div>
    </div>
    }

  </div>
</div>

<!-- Loading Overlay -->
<div *ngIf="loading" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 9999;">
  <div style="background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); padding: 40px; border-radius: 24px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.3);">
    <div style="width: 50px; height: 50px; border: 4px solid #e5e7eb; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
    <div style="font-size: 1.2rem; font-weight: 600; color: #374151;">‚è≥ Loading...</div>
  </div>
</div>

<!-- CSS Animations -->
<style>
@keyframes gradientFlow {
  0% { transform: rotate(0deg) scale(1); }
  25% { transform: rotate(90deg) scale(1.1); }
  50% { transform: rotate(180deg) scale(1); }
  75% { transform: rotate(270deg) scale(1.1); }
  100% { transform: rotate(360deg) scale(1); }
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.9; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
